CREATE DATABASE IF NOT EXISTS sima;
USE sima;
CREATE TABLE IF NOT EXISTS `users` (
    `id` INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    `email` VARCHAR(150) NOT NULL UNIQUE,
    `name` VARCHAR(150) NOT NULL,
    `password` VARCHAR(255) NOT NULL,
    `role` ENUM('admin', 'vendedor', 'supervisor') DEFAULT 'vendedor',
    `active` TINYINT(1) DEFAULT 1,
    `last_login` DATETIME DEFAULT NULL,
	`login_attempts` INT DEFAULT 0,
	`reset_token` VARCHAR(255) DEFAULT NULL,
	`reset_token_expiry` DATETIME DEFAULT NULL,
	`email_verified_at` DATETIME DEFAULT NULL,
	`person_id` INT UNSIGNED DEFAULT NULL,
	`level` INT DEFAULT 0,
    `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
	`delete_at` TIMESTAMP DEFAULT NULL,
);
CREATE TABLE IF NOT EXISTS `person` (
    `id` INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    `first_name` VARCHAR(150) NOT NULL,
	`second_name`VARCHAR(150),
	`third_name` VARCHAR(150),
    `last_name` VARCHAR(150) NOT NULL,
	`second_last_name` VARCHAR(150),
	`third_last_name` VARCHAR(150),
    `email` VARCHAR(150) NOT NULL UNIQUE,
	`vat_number` VARCHAR(150),
	`dui_number` VARCHAR(150),
	`nit_number` VARCHAR(150),
    `phone` VARCHAR(20) NOT NULL,
    `address` VARCHAR(255) NOT NULL,
    `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
	`delete_at` TIMESTAMP DEFAULT NULL,
);
CREATE TABLE IF NOT EXISTS `levels` (
    `id` INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    `name` VARCHAR(150) NOT NULL,
    `description` VARCHAR(255) NOT NULL,
	`permisions` JSON NOT NULL,
    `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
	`delete_at` TIMESTAMP DEFAULT NULL,
);
CREATE TABLE IF NOT EXISTS `roles` (
    `id` INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    `name` VARCHAR(150) NOT NULL,
    `description` VARCHAR(255) NOT NULL,
	`permisions` JSON NOT NULL,
    `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
	`delete_at` TIMESTAMP DEFAULT NULL,
);
CREATE TABLE IF NOT EXISTS `permisions` (
    `id` INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    `name` VARCHAR(150) NOT NULL,
    `description` VARCHAR(255) NOT NULL,
    `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
	`delete_at` TIMESTAMP DEFAULT NULL,
);
CREATE TABLE IF NOT EXISTS `sessions` (
    `id` INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    `user_id` INT UNSIGNED NOT NULL,
    `token` VARCHAR(255) NOT NULL,
    `ip_address` VARCHAR(45) NOT NULL,
    `user_agent` TEXT NOT NULL,
    `expires_at` DATETIME NOT NULL,
    `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
	`delete_at` TIMESTAMP DEFAULT NULL,
);
